YUI.add("moodle-local_bulkmeta-selector",function(e,t){M.local_bulkmeta=M.local_bulkmeta||{},M.local_bulkmeta.selector={AJAX_SEARCH_URL:M.cfg.wwwroot+"/local/bulkmeta/search.ajax.php?searchtext={query}&id={id}&sesskey={sesskey}",courseid:null,name:null,options:["searchanywhere","fullname","idnumber","summary"],init:function(t,n){this.courseid=t,this.name=n,e.one("#id_"+n+"_searchbutton").remove(),e.one("#id_"+n+"_clearbutton").remove(),this.searchfield=e.one("#id_"+n+"_searchtext"),this.searchfield.plug(e.Plugin.AutoComplete),this.searchfield.ac.set("source",this.prepare_url(this.AJAX_SEARCH_URL,t)),this.searchfield.ac.set("resultListLocator","results"),this.searchfield.ac.set("resultTextLocator","fullname"),this.searchfield.ac.on("results",e.bind(this.fill_listbox,this)),this.searchfield.on("key",e.bind(this.backspace,this),"backspace"),this.listbox=e.one("#id_"+n+"_link");for(var r in this.options){var i=this.options[r],s=e.one("#id_"+n+"_option_"+i);s&&s.on("click",this.set_user_preference,null,n,i)}},backspace:function(){this.get_search_text()===""&&this.searchfield.ac.sendRequest(""),this.searchfield.ac.focus()},get_search_text:function(){return this.searchfield.get("value").toString().replace(/^ +| +$/,"")},prepare_url:function(t,n){return e.Lang.sub(t,{sesskey:M.cfg.sesskey,id:n})},fill_listbox:function(t){var n=t.data,r={},i=e.Node.create("<optgroup></optgroup>");this.listbox.all("optgroup").each(function(e){e.all("option").each(function(e){e.get("selected")&&(r[e.get("value")]={id:e.get("value"),name:e.get("innerText")||e.get("textContent"),disabled:e.get("disabled")}),e.remove()},this),e.remove()},this),count=0;for(var s in n.result.results){var o=e.Node.create('<option value="'+s+'">'+n.result.results[s]+"</option>");i.append(o),count++}i.set("label",n.result.label),this.listbox.append(i)},set_user_preference:function(t,n,r){M.util.set_user_preference(n+"_option_"+r,e.one("#id_"+n+"_option_"+r).get("checked"))}}},"@VERSION@",{requires:["base","node","json-parse","autocomplete","autocomplete-filters","autocomplete-highlighters","event","event-key"]});
